"use strict";app.template_cache={templates:{},get:function(a){return this.templates[a]},set:function(a,b){this.templates[a]=b},remove:function(a){delete this.templates[a]},path_to_id:function(a){return a.replace("/","-")},load:function(a,b){if(a){var c=[];_.each(a,function(a){app.template_cache.get(a)||c.push(a)});var d=0;c.length>0?_.each(c,function(a){$.get(SITE_URL+"partials/"+a,function(e){d++,app.template_cache.set(a,e),d>=c.length&&b()})}):b()}}},function(a){a.fn.serializeObject=function(){var b=this,c={},d={},e={validate:/^[a-zA-Z][a-zA-Z0-9_]*(?:\[(?:\d*|[a-zA-Z0-9_]+)\])*$/,key:/[a-zA-Z0-9_]+|(?=\[\])/g,push:/^$/,fixed:/^\d+$/,named:/^[a-zA-Z0-9_]+$/};this.build=function(a,b,c){return a[b]=c,a},this.push_counter=function(a){return void 0===d[a]&&(d[a]=0),d[a]++};var f=a(this).serializeArray(),g=a.map(a(this).find('input[type="checkbox"]:not(:checked)'),function(a){return{name:a.name,value:0}});return f=f.concat(g),a.each(f,function(){if(e.validate.test(this.name)){for(var d,f=this.name.match(e.key),g=this.value,h=this.name;void 0!==(d=f.pop());)h=h.replace(new RegExp("\\["+d+"\\]$"),""),d.match(e.push)?g=b.build([],b.push_counter(h),g):d.match(e.fixed)?g=b.build([],d,g):d.match(e.named)&&(g=b.build({},d,g));c=a.extend(!0,c,g)}}),c}}(jQuery),app.BaseRouter=Backbone.Router.extend({container:"#backbone-container",alert_container:".alert-container",template_cache:{},start:function(a,b){Modernizr.history?Backbone.history.start({pushState:!0,root:a}):(Backbone.history.start({hashChange:!0,root:a}),b&&Backbone.history.loadUrl(b))},renderViewComplex:function(a,b){app.template_cache.load([a.template_name],function(){a.render(),b&&b()})},renderView:function(a,b,c){b||(b=this.container),app.template_cache.load([a.template_name],function(){$(b).empty(),a.render().$el.appendTo(b),c&&c()})},renderCollectionView:function(a,b,c,d){c||(c=this.container),app.template_cache.load([a.template_name],function(){$(c).empty(),a.render(b).$el.appendTo(c),d&&d()})},confirm:function(a,b,c){this.confirmModalView&&(this.confirmModalView.remove(),this.confirmView.remove()),this.confirmView=new app.ConfirmView({text:b}),this.confirmModalView=new Backbone.BootstrapModal({content:this.confirmView,title:a,modalClass:"confirm",okText:"Yes",cancelText:"No",okCloses:!0}).open(),this.confirmModalView.on("ok",c)}}),app.BaseListCollection=Backbone.Collection.extend({initialize:function(a){a&&(this.view=a.view,this.options=a)}}),app.BaseModel=Backbone.Model.extend({idAttribute:"uuid",initialize:function(a){a&&a.urlRoot&&(this.urlRoot=a.urlRoot),Backbone.Model.prototype.initialize.call(this,a)}}),app.BaseView=Backbone.View.extend({template_name:"",alert_container:".alert-container",template:function(a){return _.template(app.template_cache.get(this.template_name),a)},initialize:function(a){this.options=a},render:function(){var a=this.options?this.options:{};return this.model&&(a=$.extend(a,this.model.toJSON())),this.$el.html(this.template(a)),this},destroy:function(a,b,c,d){var e=this;(!d||d.length<1)&&(d=this.$el),b||(b=this.model),b.destroy({success:function(b,f){if(f&&f.message){var g=d.find(".submit-container .alert-success");g.html("<strong>Success: </strong> "+f.message).show(),g.delay(3e3).fadeOut()}e.trigger("save_complete",a,b),c&&c(f)},error:function(a,b){var c=d.find(".submit-container .alert-danger"),e="";e=b.responseJSON&&b.responseJSON.message?b.responseJSON.message:"<strong>Error: </strong> There was an error with your submission.  Please try again",app.log(e,{method:"BaseView.destroy",model:a,xhr:b}),c.html(e).show()}})},save:function(a,b,c,d,e){if((!d||d.length<1)&&(d=this.$el),e||(e={}),d.find("form").validate(),d.find("form").valid()){e=$.extend(e,d.find("form").serializeObject());var f=this,g=d.find(".submit-container button.submit");g.button("loading"),d.find(".submit-container .alert").hide(),b||(b=this.model),b.save(e,{success:function(a,e){if(e&&e.message){var h=d.find(".submit-container .alert-success");h.html("<strong>Success: </strong> "+e.message).show(),h.delay(3e3).fadeOut(),e.data&&e.data.uuid&&b.set("uuid",e.data.uuid)}g.button("reset"),c&&c(e),f.trigger("save_complete")},error:function(a,b){var c=d.find(".submit-container .alert-danger"),e="";e=b.responseJSON&&b.responseJSON.message?b.responseJSON.message:"<strong>Error: </strong> There was an error with your submission.  Please try again",app.log(e,{method:"BaseView.save",model:a,xhr:b}),c.html(e).show(),g.button("reset")}})}return!1}}),app.FourOhFourView=app.BaseView.extend({id:"file-not-found",className:"file-not-found",default_template_name:"404"}),function(a,b,c){var d=b.templateSettings;b.templateSettings={interpolate:/\{\{(.+?)\}\}/g,evaluate:/<%([\s\S]+?)%>/g};var e=b.template('<div class="modal-dialog {{modalClass}}"><div class="modal-content"><% if (title) { %><div class="modal-header"><% if (allowCancel) { %><a class="close">&times;</a><% } %><h3>{{title}}</h3></div><% } %><div class="modal-body">{{content}}</div><div class="modal-footer"><% if (allowCancel) { %><% if (cancelText) { %><a href="#" class="btn cancel">{{cancelText}}</a><% } %><% } %><% if(allowOk) { %><a href="#" class="btn ok btn-primary">{{okText}}</a><% } %></div></div></div>');b.templateSettings=d;var f=c.View.extend({className:"modal",events:{"click .close":function(a){a.preventDefault(),this.trigger("cancel"),this.options.content&&this.options.content.trigger&&this.options.content.trigger("cancel",this)},"click .cancel":function(a){a.preventDefault(),this.trigger("cancel"),this.options.content&&this.options.content.trigger&&this.options.content.trigger("cancel",this)},"click .ok":function(a){a.preventDefault(),this.trigger("ok"),this.options.content&&this.options.content.trigger&&this.options.content.trigger("ok",this),this.options.okCloses&&this.close()}},initialize:function(a){this.options=b.extend({title:null,okText:"OK",focusOk:!0,allowOk:!0,okCloses:!0,cancelText:"Cancel",allowCancel:!0,escape:!0,animate:!1,modalClass:"",template:e},a)},render:function(){var a=this.$el,b=this.options,c=b.content;return a.html(b.template(b)),c.$el&&(c.render(),a.find(".modal-body").html(c.$el)),b.animate&&a.addClass("fade"),this.isRendered=!0,this},open:function(c){this.isRendered||this.render();var d=this,e=this.$el;e.modal(b.extend({keyboard:this.options.allowCancel,backdrop:this.options.allowCancel?!0:"static"},this.options.modalOptions)),e.one("shown",function(){d.options.focusOk&&e.find(".btn.ok").focus(),d.options.content&&d.options.content.trigger&&d.options.content.trigger("shown",d),d.trigger("shown")});var g=f.count,h=a(".modal-backdrop:eq("+g+")"),i=parseInt(h.css("z-index"),10),j=parseInt(h.css("z-index"),10);return h.css("z-index",i+g),this.$el.css("z-index",j+g),this.options.allowCancel&&(h.one("click",function(){d.options.content&&d.options.content.trigger&&d.options.content.trigger("cancel",d),d.trigger("cancel")}),a(document).one("keyup.dismiss.modal",function(a){27===a.which&&d.trigger("cancel"),d.options.content&&d.options.content.trigger&&27===a.which&&d.options.content.trigger("shown",d)})),this.on("cancel",function(){d.close()}),f.count++,c&&d.on("ok",c),this},close:function(){var a=this,b=this.$el;return this._preventClose?void(this._preventClose=!1):(b.one("hidden",function c(d){return d.target!==d.currentTarget?b.one("hidden",c):(a.remove(),a.options.content&&a.options.content.trigger&&a.options.content.trigger("hidden",a),void a.trigger("hidden"))}),b.modal("hide"),void f.count--)},preventClose:function(){this._preventClose=!0}},{count:0});"function"==typeof require&&"undefined"!=typeof module&&exports?module.exports=f:c.BootstrapModal=f}(jQuery,_,Backbone),app.BaseFormView=app.BaseView.extend({render:function(){app.BaseView.prototype.render.call(this);var a=this;return a.model&&this.$el.find("select").each(function(){var b=a.model.get($(this).attr("name"));void 0!==typeof b&&$(this).val(b)}),this.$el.find("form").validate(),this}}),app.BaseListView=app.BaseView.extend({render:function(a){this.collection=a;var b=this.options?this.options:{};return a&&(b.objects=a.toJSON()),this.$el.html(this.template(b)),this}}),app.ConfirmView=Backbone.View.extend({id:"confirm",template:function(a){var b=_.template('<div class="text"><p><%=text%></p></div>');return b(a)},initialize:function(a){this.options=a},render:function(){var a=this.options?this.options:{};return this.$el.html(this.template(a)),this}}),app.DataTableView=app.BaseView.extend({template_name:"admin/datatable",table:void 0,events:{"click .dataTable tr td":"edit"},initialize:function(a){a=a||{},this.options=_.extend({remote:!0,method:"POST",perPage:20,columns:[],sorting:[]},a)},render:function(){return this.$el.html(this.template(this.options)),this.render_table(),this},get_filter_params:function(){},render_table:function(){var a=this;this.table=this.$el.find("#datatable").dataTable({sAjaxSource:this.options.url,bServerSide:this.options.remote,sServerMethod:this.options.method,iDisplayLength:this.options.perPage,aoColumns:this.options.columns,aaSorting:this.options.sorting,fnServerParams:function(b){a.get_filter_params(b)}})},edit:function(a){var b=$(a.currentTarget).closest("tr").attr("id");return app.router.navigate(this.options.edit_url+b,!0),!1}}),app.Availability=app.BaseModel.extend({urlRoot:app.rest_root+"users/availability"}),app.AvailabilityCalendar=app.BaseModel.extend({idAttribute:"id",urlRoot:app.rest_root+"users/availability_calendar"}),app.Conversation=app.BaseModel.extend({urlRoot:app.rest_root+"conversations/conversation"}),app.Customer=app.BaseModel.extend({urlRoot:app.rest_root+"users/customer"}),app.Dashboard=app.BaseModel.extend({defaults:{counselors:0,customers:0,requests:0,transactions:0,last_30_customers:0,last_30_counselors:0,last_30_requests:0,last_30_transactions:0,last_30_money:0},urlRoot:app.rest_root+"admin/dashboard"}),app.Diary=app.BaseModel.extend({urlRoot:app.rest_root+"diaries/diary",defaults:{draft:1}}),app.Event=app.BaseModel.extend({urlRoot:app.rest_root+"events/event"}),app.Message=app.BaseModel.extend({urlRoot:app.rest_root+"messages/message"}),app.Note=app.BaseModel.extend({urlRoot:app.rest_root+"notes/note"}),app.Notification=app.BaseModel.extend({urlRoot:app.rest_root+"notifications/notification"}),app.Payable=app.BaseModel.extend({urlRoot:app.rest_root+"admin/payables/payable"}),app.Payout=app.BaseModel.extend({urlRoot:app.rest_root+"admin/payouts/payout"}),app.Plan=app.BaseModel.extend({urlRoot:app.rest_root+"plans"}),app.Pricing=app.BaseModel.extend({urlRoot:app.rest_root+"plans/pricing"}),app.Registration=app.BaseModel.extend({defaults:{step:1,completed:0,firstname:"",lastname:"",email:"",birthday:"",mobile_phone:"",gender:"",referral:"",referral_counselor:"",referral_other:"",address:"",state:"",zipcode:"",city:"",school_occupation:"",username:"",password:"",preferred_coach:"",preferred_coaching_time:"",coaching_qualifications:"",parent_email:"",parent_consent:0,counselor_before_more:"",drugs_alcohol_more:"",sleeping_changes_more:"",medical_diagnosis_more:"",suicide_homicide_more:"",pop_culture:"",interest:"",dream:"",family:"",focus:""},urlRoot:function(){return this.user_uuid?app.rest_root+"registrations/user/"+this.user_uuid:app.rest_root+"registrations/registration"}}),app.Transaction=app.BaseModel.extend({urlRoot:app.rest_root+"transactions/transaction"}),app.User=app.BaseModel.extend({urlRoot:app.rest_root+"users/user"}),app.ConversationListCollection=app.BaseListCollection.extend({model:app.Conversation,url:app.rest_root+"conversations"}),app.CustomerListCollection=app.BaseListCollection.extend({model:app.Customer,url:app.rest_root+"customers"}),app.DiaryListCollection=app.BaseListCollection.extend({model:app.Diary,url:function(){return this.uuid?app.rest_root+"diaries/user/"+this.uuid:app.rest_root+"diaries/"}}),app.EventListCollection=app.BaseListCollection.extend({model:app.Event,url:function(){return this.uuid?app.rest_root+"events/user/"+this.uuid:app.rest_root+"events/"}}),app.MessageListCollection=app.BaseListCollection.extend({model:app.Message,url:function(){return this.uuid?app.rest_root+"messages/conversation/"+this.uuid:app.rest_root+"messages/"}}),app.NoteListCollection=app.BaseListCollection.extend({model:app.Note,url:function(){return this.uuid?app.rest_root+"notes/user/"+this.uuid:app.rest_root+"notes/"}}),app.PlanListCollection=app.BaseListCollection.extend({model:app.Plan,url:function(){return app.rest_root+"plans/"}}),app.DashboardCounselorRouter=app.BaseRouter.extend({container:"#dashboard-container",root_url:app.app_root+"dashboard/",routes:{calendar:"calendar","calendar/":"calendar",conversations:"conversation","conversations/":"conversation","conversation/:id":"conversation","conversation/:id/":"conversation",message:"message","message/":"message",customer:"customer","customer/":"customer","customer/:id":"customer","customer/:id/":"customer","customer/:id/:path":"customer","customer/:id/:path/":"customer",customers:"customers","customers/":"customers","*path":"calendar"},_dashboard:function(a){var b=this;this.dashboardView?a():(this.user=new app.User,this.user.fetch({success:function(){b.dashboardView=new app.DashboardCounselorView({model:b.user}),b.renderViewComplex(b.dashboardView,a)}}))},calendar:function(){var a=this;a._dashboard(function(){a.calendarView&&a.calendarView.remove(),a.calendarView=new app.CalendarView,a.renderView(a.calendarView,void 0,function(){a.calendarView.build_calendar()})})},customers:function(){var a=this;a._dashboard(function(){a.customerListView&&a.customerListView.remove(),a.customerListView=new app.CustomerListView,a.customerListCollection||(a.customerListCollection=new app.CustomerListCollection([],{view:a.customerListView})),a.customerListCollection.fetch({success:function(b){a.renderCollectionView(a.customerListView,b)}})})},customer:function(a,b){var c=this;c._dashboard(function(){c.customerView&&c.customerView.remove(),c.customerView=new app.CustomerView({path:b,model:new app.Customer({uuid:a})}),c.customerView.model.fetch({success:function(){c.renderView(c.customerView)}})})},conversations:function(){},conversation:function(a){var b=this;b._dashboard(function(){b.conversationListView&&b.conversationListView.remove(),b.conversationListView=new app.ConversationListView({conversation_uuid:a}),b.conversationListCollection||(b.conversationListCollection=new app.ConversationListCollection([],{view:b.conversationListView})),b.conversationListCollection.fetch({success:function(a){b.renderCollectionView(b.conversationListView,a)}})})},message:function(){var a=this;a._dashboard(function(){a.messageView&&a.messageView.remove(),a.messageView=new app.MessageView({model:new app.Message}),a.messageView.cancel_url=app.router.root_url+"conversations/",a.messageView.model.fetch({success:function(){a.renderView(a.messageView,void 0,function(){var a=$("#message").offset().top;$("html,body").animate({scrollTop:a},300)})}})})}}),"dashboardCounselor"===app.activeRouter&&(app.dashboardCounselorRouter=new app.DashboardCounselorRouter,app.router=app.dashboardCounselorRouter,$(document).ready(function(){app.dashboardCounselorRouter.start(app.app_root+"dashboard/")})),app.DashboardCustomerRouter=app.BaseRouter.extend({container:"#dashboard-container",root_url:app.app_root+"dashboard/",routes:{events:"events","events/":"events",messages:"messages","messages/":"messages",message:"message","message/":"message",diary:"diary","diary/":"diary","diary/:id":"diary","diary/:id/":"diary","event/:id":"event","event/:id/":"event","add-video":"add_video","add-video/":"add_video",diaries:"diaries","diaries/":"diaries","*path":"events"},_dashboard:function(a){var b=this;this.dashboardView?a():(this.user=new app.User,this.user.fetch({success:function(){b.dashboardView=new app.DashboardCustomerView({model:b.user}),b.renderViewComplex(b.dashboardView,a)}}))},events:function(){var a=this;a._dashboard(function(){a.eventListView&&a.eventListView.remove(),a.eventListView=new app.EventListView,a.eventListCollection||(a.eventListCollection=new app.EventListCollection([],{view:a.eventListView})),a.eventListCollection.fetch({success:function(b){a.renderCollectionView(a.eventListView,b)}})})},event:function(a){var b=this;b._dashboard(function(){b.eventView&&b.eventView.remove(),b.eventView=new app.EventView({model:new app.Event({uuid:a})}),b.eventView.model.fetch({success:function(){b.renderView(b.eventView,void 0,function(){var a=$("#event").offset().top;$("html,body").animate({scrollTop:a},300)})}})})},add_video:function(){var a=this;a._dashboard(function(){parseInt(app.user.credits)-parseInt(app.user.pending_credits)>=app.data.credits_counseling?(a.videoAddView&&a.videoAddView.remove(),a.availability=new app.Availability,a.availability.fetch({success:function(){a.videoAddView=new app.VideoAddView({availability:a.availability}),a.renderView(a.videoAddView,void 0,function(){var a=$("#video_add").offset().top;$("html,body").animate({scrollTop:a},300)})}})):app.error_message(app.msg_error.credits_invalid_video,a.alert_container)})},diary:function(a){var b=this;b._dashboard(function(){app.user.counselor.uuid?a||parseInt(app.user.credits)-parseInt(app.user.pending_credits)>=app.data.credits_diary?(b.diaryView&&b.diaryView.remove(),b.diaryView=new app.DiaryView({model:new app.Diary({uuid:a})}),b.diaryView.model.fetch({success:function(){b.renderView(b.diaryView,void 0,function(){var a=$("#diary").offset().top;$("html,body").animate({scrollTop:a},300)})}})):app.error_message(app.msg_error.credits_invalid_diary,b.alert_container):app.error_message(app.msg_error.no_counselor,b.alert_container)})},diaries:function(){var a=this;a._dashboard(function(){a.diaryListView&&a.diaryListView.remove(),a.diaryListView=new app.DiaryListCustomerView,a.diaryListCollection||(a.diaryListCollection=new app.DiaryListCollection([],{view:a.diaryListView})),a.diaryListCollection.fetch({success:function(b){a.renderCollectionView(a.diaryListView,b)}})})},messages:function(){var a=this;a._dashboard(function(){$.get(app.rest_root+"conversations/conversation",{},function(b){var c=0;b&&b.uuid&&(c=b.uuid),a.messageListView&&a.messageListView.remove(),a.messageListView=new app.MessageListView({conversation_uuid:c}),a.messageListCollection||(a.messageListCollection=new app.MessageListCollection([],{view:a.messageListView})),a.messageListCollection.fetch({success:function(b){a.renderCollectionView(a.messageListView,b)}})})})},message:function(){var a=this;a._dashboard(function(){app.user.counselor.uuid?(a.messageView&&a.messageView.remove(),a.messageView=new app.MessageView({model:new app.Message}),a.messageView.model.fetch({success:function(){a.renderView(a.messageView,void 0,function(){});var b=$("#message").offset().top;$("html,body").animate({scrollTop:b},300)}})):app.error_message(app.msg_error.no_counselor,a.alert_container)})}}),"dashboardCustomer"===app.activeRouter&&(app.dashboardCustomerRouter=new app.DashboardCustomerRouter,app.router=app.dashboardCustomerRouter,$(document).ready(function(){app.dashboardCustomerRouter.start(app.app_root+"dashboard/")})),app.MyAccountRouter=app.BaseRouter.extend({container:"#my-account-container",root_url:app.app_root+"my_account/",routes:{profile:"profile","profile/":"profile",notifications:"notifications","notifications/":"notifications",password:"password","password/":"password",payment:"payment","payment/":"payment",account_type:"account_type","account_type/":"account_type",availability:"availability","availability/":"availability","*path":"profile"},_my_account:function(a){this.myAccountView?a():(this.myAccountView=new app.MyAccountView,this.renderViewComplex(this.myAccountView,a))},_get_user:function(a){this.user?a():(this.user=new app.User,this.user.fetch({success:a}))},profile:function(){var a=this;a.profileView&&a.profileView.remove(),this._get_user(function(){a.registration=new app.Registration,a.registration.user_uuid=app.user.uuid,a._my_account(function(){a.registration.fetch({success:function(){a.profileView=new app.ProfileView({model:a.user,registration:a.registration.toJSON()}),a.profileView.registration=a.registration,a.renderView(a.profileView)}})})})},notifications:function(){var a=this;a.notificationsView&&a.notificationsView.remove(),this._get_user(function(){a._my_account(function(){a.notificationsView=new app.NotificationsView({model:a.user}),a.renderView(a.notificationsView)})})},password:function(){var a=this;a.passwordView&&a.passwordView.remove(),this._get_user(function(){a._my_account(function(){a.passwordView=new app.PasswordView({model:a.user}),a.renderView(a.passwordView)})})},account_type:function(){var a=this;a.accountTypeView&&a.accountTypeView.remove(),this._get_user(function(){a._my_account(function(){a.pricing=new app.Pricing,a.pricing.fetch({success:function(){a.accountTypeView=new app.AccountTypeView({model:a.user,pricing:a.pricing}),a.renderView(a.accountTypeView)}})})})},availability:function(){var a=this;a.availabilityView&&a.availabilityView.remove(),this._get_user(function(){a._my_account(function(){a.availability=new app.Availability,a.availability.fetch({success:function(){a.availabilityView=new app.AvailabilityView({model:a.user,availability:a.availability}),a.renderView(a.availabilityView)}})})})},payment:function(){var a=this;a.paymentView&&(a.paymentView.remove(),app.template_cache.remove("my_account/payment")),this._get_user(function(){a._my_account(function(){a.paymentView=new app.PaymentView({model:a.user}),a.renderView(a.paymentView)})})}}),"myAccount"===app.activeRouter&&(app.myAccountRouter=new app.MyAccountRouter,app.router=app.myAccountRouter,$(document).ready(function(){app.myAccountRouter.start(app.app_root+"my_account/")})),app.AdminRouter=app.BaseRouter.extend({root_url:app.admin_root,routes:{counselors:"counselors","counselors/":"counselors",counselor:"counselor","counselor/:id":"counselor",customers:"customers","customers/":"customers",customer:"customer","customer/:id":"customer",requests:"requests","requests/":"requests",transactions:"transactions","transactions/":"transactions",transaction:"transaction","transaction/:id":"transaction",payouts:"payouts","payouts/":"payouts",payout:"payout","payout/:id":"payout",payables:"payables","payables/":"payables",payable:"payable","payable/:id":"payable",notifications:"notifications","notifications/":"notifications",notification:"notification","notification/:id":"notification",pricing:"pricing","*path":"dashboard"},_admin:function(a,b,c,d){this.adminView||(this.adminView=new app.admin.AdminView({}),this.adminView.render()),this.adminView.set_page(a,b,c,d)},dashboard:function(){var a=this;app.template_cache.load(["admin/admin","admin/dashboard"],function(){a._admin("Dashboard","dashboard"),a.dashboardView&&a.dashboardView.remove(),a.dashboardView=new app.admin.DashboardView({model:new app.Dashboard({})}),a.dashboardView.model.fetch({success:function(){a.renderView(a.dashboardView)}})})},counselors:function(){var a=this;app.template_cache.load(["admin/admin","admin/datatable"],function(){a._admin("Coaches","counselors","Add Coach",function(){app.adminRouter.navigate("counselor",!0)}),a.dataTableView&&a.dataTableView.remove(),a.dataTableView=new app.DataTableView({url:app.rest_root+"admin/users/counselors",edit_url:"counselor/",cls:"counselors",columns:[{title:"Last Name",mDataProp:"lastname"},{title:"First Name",mDataProp:"firstname"},{title:"Username",mDataProp:"username"},{title:"Created",mDataProp:"created"},{title:"Last Login",mDataProp:"last_login"}]}),a.renderView(a.dataTableView)})},counselor:function(a){var b=this;app.template_cache.load(["admin/admin","admin/counselor"],function(){a?b._admin("Edit Coach","counselors"):b._admin("Add Coach","counselors"),b.counselorView&&b.counselorView.remove(),b.counselorView=new app.admin.CounselorView({model:new app.User({urlRoot:app.rest_root+"admin/users/user",uuid:a,user_type_id:app.user_type_counselor})}),b.counselorView.model.fetch({success:function(){b.renderView(b.counselorView)}})})},customers:function(){var a=this;app.template_cache.load(["admin/admin","admin/datatable"],function(){a._admin("Customers","customers","Add Customer",function(){app.adminRouter.navigate("customer",!0)}),a.dataTableView&&a.dataTableView.remove(),a.dataTableView=new app.admin.CustomerDataTableView({url:app.rest_root+"admin/users/customers",edit_url:"customer/",cls:"customers",columns:[{title:"Last Name",mDataProp:"lastname"},{title:"First Name",mDataProp:"firstname"},{title:"Username",mDataProp:"username"},{title:"Created",mDataProp:"created"},{title:"Last Login",mDataProp:"last_login"}]}),a.renderView(a.dataTableView)})},customer:function(a){var b=this;app.template_cache.load(["admin/admin","admin/customer"],function(){a?b._admin("Edit Customer","customers"):b._admin("Add Customer","customers"),b.customerView&&b.customerView.remove(),b.customerView=new app.admin.CustomerView({model:new app.User({urlRoot:app.rest_root+"admin/users/user",uuid:a,user_type_id:app.user_type_customer})}),b.customerView.model.fetch({success:function(){b.renderView(b.customerView)}})})},requests:function(){var a=this;app.template_cache.load(["admin/admin","admin/datatable"],function(){a._admin("Requests","requests")})},transactions:function(){var a=this;app.template_cache.load(["admin/admin","admin/datatable"],function(){a._admin("Transactions","transactions"),a.dataTableView&&a.dataTableView.remove(),a.dataTableView=new app.DataTableView({url:app.rest_root+"admin/transactions",edit_url:"transaction/",cls:"transactions",sorting:[[1,"desc"]],columns:[{title:"Transaction Number",mDataProp:"transaction_nbr"},{title:"Created",mDataProp:"created"},{title:"Customer",mDataProp:"customer"},{title:"Coach",mDataProp:"counselor"},{title:"Amount",mDataProp:"amount"}]}),a.renderView(a.dataTableView)})},transaction:function(a){var b=this;return a?void app.template_cache.load(["admin/admin","admin/transaction"],function(){b._admin("View Transaction","transactions"),b.transactionView&&b.transactionView.remove(),b.transactionView=new app.admin.TransactionView({model:new app.Transaction({urlRoot:app.rest_root+"admin/transactions/transaction",uuid:a})}),b.transactionView.model.fetch({success:function(){b.renderView(b.transactionView)}})}):void app.adminRouter.navigate("transactions",!0)},payouts:function(){var a=this;app.template_cache.load(["admin/admin","admin/datatable"],function(){a._admin("Past Payouts","payouts"),a.dataTableView&&a.dataTableView.remove(),a.dataTableView=new app.DataTableView({url:app.rest_root+"admin/payouts",edit_url:"payout/",cls:"payouts",sorting:[[1,"desc"]],columns:[{title:"Date",mDataProp:"created"},{title:"Last Name",mDataProp:"lastname"},{title:"First Name",mDataProp:"firstname"},{title:"Transaction Nbr",mDataProp:"stripe_transfer_id"},{title:"Amount",mDataProp:"amount"}]}),a.renderView(a.dataTableView)})},payout:function(a){var b=this;return a?void app.template_cache.load(["admin/admin","admin/payout"],function(){b._admin("Pay Coach","payouts"),b.payoutView&&b.payoutView.remove(),b.payoutView=new app.admin.PayoutView({model:new app.Payout({urlRoot:app.rest_root+"admin/payouts/payout",uuid:a})}),b.payoutView.model.fetch({success:function(){b.renderView(b.payoutView)}})}):void app.adminRouter.navigate("payouts",!0)},payables:function(){var a=this;app.template_cache.load(["admin/admin","admin/datatable"],function(){a._admin("Coaches to be Paid","payables"),a.dataTableView&&a.dataTableView.remove(),a.dataTableView=new app.DataTableView({url:app.rest_root+"admin/payables",edit_url:"payable/",cls:"payables",sorting:[[1,"desc"]],columns:[{title:"Last Name",mDataProp:"lastname"},{title:"First Name",mDataProp:"firstname"},{title:"Username",mDataProp:"username"},{title:"Amount Due",mDataProp:"amount"}]}),a.renderView(a.dataTableView)})},payable:function(a){var b=this;return a?void app.template_cache.load(["admin/admin","admin/payable"],function(){b._admin("Pay Coach","payables"),b.payableView&&b.payableView.remove(),b.payableView=new app.admin.PayableView({model:new app.Payable({urlRoot:app.rest_root+"admin/payables/payable",uuid:a})}),b.payableView.model.fetch({success:function(){b.renderView(b.payableView)}})}):void app.adminRouter.navigate("payables",!0)},notifications:function(){var a=this;app.template_cache.load(["admin/admin","admin/datatable"],function(){a._admin("Automated Email Notification Templates","notifications"),a.dataTableView&&a.dataTableView.remove(),a.dataTableView=new app.DataTableView({url:app.rest_root+"admin/notifications",edit_url:"notification/",cls:"notifications",columns:[{title:"Template",mDataProp:"name",sClass:"name"},{title:"Description",mDataProp:"description",sClass:"description"}]}),a.renderView(a.dataTableView)})},notification:function(a){var b=this;return a?void app.template_cache.load(["admin/admin","admin/notification"],function(){b._admin("Edit Notification Template","notifications"),b.notificationView&&b.notificationView.remove(),b.notificationView=new app.admin.NotificationView({model:new app.Notification({urlRoot:app.rest_root+"admin/notifications/notification",uuid:a})}),b.notificationView.model.fetch({success:function(){b.renderView(b.notificationView)}})}):void app.adminRouter.navigate("notifications",!0)},pricing:function(){var a=this;app.template_cache.load(["admin/admin","admin/pricing"],function(){a._admin("Edit Pricing","pricing"),a.pricingView&&a.pricingView.remove(),a.pricingView=new app.admin.PricingView({model:new app.Pricing({urlRoot:app.rest_root+"admin/plans/pricing"})}),a.pricingView.model.fetch({success:function(){a.renderView(a.pricingView)}})})}}),"admin"===app.activeRouter&&(app.adminRouter=new app.AdminRouter,app.router=app.adminRouter,$(document).ready(function(){app.adminRouter.start(app.app_root+"admin/")})),app.RegistrationRouter=app.BaseRouter.extend({root_url:app.app_root+"accounts/registration/",routes:{step1:"step1","step1/":"step1",step2:"step2","step2/":"step2",step3:"step3","step3/":"step3",step4:"step4","step4/":"step4",step5:"step5","step5/":"step5",plan:"plan","plan/":"plan","*path":"step1"},_get_registration:function(a){this.registration?a():(this.registration=new app.Registration,this.registration.fetch({success:a}))},_step:function(a,b){var c=this;$("#registration-progress li a.active").removeClass("active"),$("#registration-progress .step"+a+" a").addClass("active"),this._get_registration(function(){var d="registration/"+a;"number"==typeof a&&(d="registration/step"+a),app.template_cache.load([d],function(){c.step1View&&c.step1View.remove(),c.step2View&&c.step2View.remove(),c.step3View&&c.step3View.remove(),c.step4View&&c.step4View.remove(),c.step5View&&c.step5View.remove(),c.planView&&c.planView.remove(),b()})})},_validate_registration:function(){return this.registration.get("uuid")},step1:function(){var a=this;this._step(1,function(){$.getJSON(app.rest_root+"registrations/counselors",function(b){a.registration.set("counselors",b),a.step1View=new app.Step1View({model:a.registration}),console.log(a.registration),a.renderView(a.step1View)})})},step2:function(){var a=this;this._step(2,function(){a._validate_registration()?(a.step2View=new app.Step2View({model:a.registration}),a.renderView(a.step2View)):app.registrationRouter.navigate("step1",!0)})},step3:function(){var a=this;this._step(3,function(){a._validate_registration()?(a.step3View=new app.Step3View({model:a.registration}),a.renderView(a.step3View)):app.registrationRouter.navigate("step1",!0)})},step4:function(){var a=this;this._step(4,function(){a._validate_registration()?(a.step4View=new app.Step4View({model:a.registration}),a.renderView(a.step4View)):app.registrationRouter.navigate("step1",!0)})},step5:function(){var a=this;this._step(5,function(){a._validate_registration()?(a.step5View=new app.Step5View({model:a.registration}),a.renderView(a.step5View)):app.registrationRouter.navigate("step1",!0)})},plan:function(){var a=this;this._step(2,function(){a._validate_registration()?(a.pricing=new app.Pricing,a.pricing.fetch({success:function(){a.planView=new app.PlanView({model:a.registration,
pricing:a.pricing}),a.renderView(a.planView)}})):app.registrationRouter.navigate("step1",!0)})}}),"registration"===app.activeRouter&&(app.registrationRouter=new app.RegistrationRouter,app.router=app.registrationRouter,$(document).ready(function(){app.registrationRouter.start(app.app_root+"accounts/registration/")})),app.admin.AdminView=app.BaseView.extend({el:"#page",template_name:"admin/admin",events:{"click #sidebar .dashboard a":"dashboard","click #sidebar .counselors a":"counselors","click #sidebar .customers a":"customers","click #sidebar .transactions a":"transactions","click #sidebar .payouts a":"payouts","click #sidebar .payables a":"payables","click .page-title .action-container .btn":"btn_click"},initialize:function(a){app.BaseFormView.prototype.initialize.call(this,a)},render:function(){return app.BaseFormView.prototype.render.call(this),this},dashboard:function(a){return app.router.navigate("dashboard",!0),!1},counselors:function(a){return app.router.navigate("counselors",!0),!1},customers:function(a){return app.router.navigate("customers",!0),!1},transactions:function(a){return app.router.navigate("transactions",!0),!1},payouts:function(a){return app.router.navigate("payouts",!0),!1},payables:function(a){return app.router.navigate("payables",!0),!1},set_page:function(a,b,c,d){this.$el.find(".page-title h1").text(a),this.$el.find("#sidebar li.active").removeClass("active"),this.$el.find("#sidebar li."+b).addClass("active"),this.$el.find(".page-title .action-container").empty(),c&&(this.$el.find(".page-title .action-container").append('<button class="btn btn-primary btn-med"><i class="glyphicon glyphicon-plus"></i> '+c+"</button>"),this.btn_callback=d)},btn_click:function(a){this.btn_callback&&this.btn_callback(a)}}),app.admin.CounselorView=app.BaseFormView.extend({id:"counselor",template_name:"admin/counselor",events:{"click #delete_modal .btn-delete-confirm":"delete_permanently","click .submit-container button.cancel":"cancel","click .submit-container button.submit":"save"},render:function(){var a=this;return this.model.set("user_type_id",app.user_type_counselor),app.BaseFormView.prototype.render.call(this),this.$el.find(".datepicker").datepicker({autoclose:!0}),app.template_cache.load(["admin/admin","admin/datatable"],function(){a.dataTableView&&a.dataTableView.remove(),a.dataTableView=new app.admin.CustomerDataTableView({url:app.rest_root+"admin/users/customers/"+a.model.get("id"),edit_url:"customer/",cls:"customers",columns:[{title:"Last Name",mDataProp:"lastname"},{title:"First Name",mDataProp:"firstname"},{title:"Username",mDataProp:"username"},{title:"Created",mDataProp:"created"},{title:"Last Login",mDataProp:"last_login"}]}),app.router.renderView(a.dataTableView,a.$el.find("#counselor-customers"))}),this},cancel:function(a){return app.router.navigate("counselors",!0),!1},delete_permanently:function(a){var b=this;return $.post(app.rest_root+"admin/users/delete",{uuid:this.model.id},function(a){app.success_message(a.message,b.alert_container),app.router.navigate("counselors",!0),$("body").removeClass("modal-open")}),!1}}),app.admin.CustomerView=app.BaseFormView.extend({id:"customer",template_name:"admin/customer",events:{"click #delete_modal .btn-delete-confirm":"delete_permanently","click .submit-container button.cancel":"cancel","click .submit-container button.submit":"save","click #assign_counselor_modal .btn-primary":"assign_counselor"},render:function(){return app.BaseFormView.prototype.render.call(this),this.$el.find(".datepicker").datepicker({autoclose:!0}),this},cancel:function(a){return app.router.navigate("customers",!0),!1},assign_counselor:function(a){var b=this,c=$("#counselor_id").val();return $("#assign_counselor_modal").modal("hide"),$(".assign_counselor").button("loading"),c&&$.post(app.rest_root+"admin/users/user_counselor",{uuid:this.model.id,counselor_id:c},function(a){b.model=new app.User(a),b.render()}),!1},delete_permanently:function(a){var b=this;return $.post(app.rest_root+"admin/users/delete",{uuid:this.model.id},function(a){app.success_message(a.message,b.alert_container),app.router.navigate("customers",!0),$("body").removeClass("modal-open")}),!1}}),app.admin.CustomerDataTableView=app.DataTableView.extend({template_name:"admin/datatable-customers",counselor_id:0,events:{"click .dataTable tr td":"edit","change #counselor_id":"set_counselor_id"},set_counselor_id:function(a){this.counselor_id=$(a.currentTarget).val(),this.table.fnDraw()},get_filter_params:function(a){a.push({name:"counselor_id",value:this.counselor_id})}}),app.admin.DashboardView=app.BaseView.extend({id:"dashboard",template_name:"admin/dashboard",events:{"click button.submit":"update_config"},update_config:function(a){var b={},c=this;return this.$el.find(".config-value").each(function(){var a=$(this).val(),c=$(this).attr("name");"checkbox"!==$(this).attr("type")||$(this).is(":checked")||1==$(this).val()&&(a=0),b[c]=a}),$(a.currentTarget).button("loading"),$.post(app.rest_root+"admin/system_config/config",{config:b},function(b){$(a.currentTarget).button("reset"),app.success_message("Successfully updated the system configuration",c.$el.find(".alert-success"))},"json"),!1}}),app.admin.NotificationView=app.BaseFormView.extend({id:"notification",template_name:"admin/notification",events:{"click .submit-container button.cancel":"cancel","click .submit-container button.submit":"save","click .btn-test":"test"},render:function(){var a=this;return app.BaseFormView.prototype.render.call(this),setTimeout(function(){a.$el.find("#notification-body").show(),tinymce.init({menubar:!1,selector:"textarea#notification-body",height:400,inline_styles:!0})},500),this},cancel:function(a){return app.router.navigate("notifications",!0),!1},save:function(a,b){var c={body:tinyMCE.activeEditor.getContent({format:"raw"})};return app.BaseFormView.prototype.save.call(this,a,this.model,b,this.$el,c),!1},test:function(a){var b=this;return this.save(a,function(){b.$el.find(".submit-container .alert").hide(),$.ajax(app.rest_root+"admin/notifications/test/",{type:"POST",data:{emails:b.$el.find("#test-emails").val()},dataType:"json",success:function(a,c,d){app.success_message(a.message,b.alert_container),b.$el.find("#test_notification_modal").modal("hide")},error:function(a,c,d){app.error_message($.parseJSON(a.responseText).message,b.alert_container),b.$el.find("#test_notification_modal").modal("hide")}})}),!1}}),app.admin.PayableView=app.BaseView.extend({id:"payable",template_name:"admin/payable",events:{"click .submit-container button.back":"back","click .submit-container button.pay":"pay"},initialize:function(a){this.options=_.extend({remote:!0,method:"POST",perPage:20,columns:[{title:"Transaction Type",mDataProp:"transaction_type"},{title:"Created",mDataProp:"created"},{title:"Customer",mDataProp:"customer"},{title:"Amount",mDataProp:"amount"}],sorting:[]},a)},render:function(){return this.model.set("columns",this.options.columns),app.BaseView.prototype.render.call(this),this.render_table(),this},back:function(a){return app.router.navigate("payables",!0),!1},pay:function(a){var b=this.$el.find("button.pay");b.button("loading");var c=this;$.ajax(app.rest_root+"admin/payables/pay/"+this.model.get("uuid"),{type:"POST",dataType:"json",success:function(a,b,d){app.success_message(a.message,c.alert_container),app.router.navigate("payouts",!0)},error:function(a,d,e){app.error_message($.parseJSON(a.responseText).message,c.alert_container),b.button("reset")}})},render_table:function(){this.table=this.$el.find("#datatable").dataTable({sAjaxSource:app.rest_root+"admin/payables/payable_items/"+this.model.get("uuid"),sServerMethod:this.options.method,bServerSide:this.options.remote,iDisplayLength:this.options.perPage,aoColumns:this.options.columns,aaSorting:this.options.sorting})}}),app.admin.PayoutView=app.BaseView.extend({id:"payout",template_name:"admin/payout",events:{"click .submit-container button.back":"back","click .submit-container button.pay":"pay"},initialize:function(a){this.options=_.extend({remote:!0,method:"POST",perPage:20,columns:[{title:"Transaction Type",mDataProp:"transaction_type"},{title:"Created",mDataProp:"created"},{title:"Customer",mDataProp:"customer"},{title:"Amount",mDataProp:"amount"}],sorting:[]},a)},render:function(){return this.model.set("columns",this.options.columns),app.BaseView.prototype.render.call(this),this.render_table(),this},back:function(a){return app.router.navigate("payouts",!0),!1},render_table:function(){this.table=this.$el.find("#datatable").dataTable({sAjaxSource:app.rest_root+"admin/payouts/payable_items/"+this.model.get("uuid"),sServerMethod:this.options.method,bServerSide:this.options.remote,iDisplayLength:this.options.perPage,aoColumns:this.options.columns,aaSorting:this.options.sorting})}}),app.admin.PricingView=app.BaseFormView.extend({id:"pricing",template_name:"admin/pricing",events:{"click .submit-container button.submit":"save"},render:function(){return app.BaseFormView.prototype.render.call(this),this},save:function(a){var b=this;return app.BaseFormView.prototype.save.call(this,a,this.model,function(){b.$el.find("input.money").each(function(){$(this).val(accounting.formatMoney($(this).val()))})}),!1}}),app.admin.TransactionView=app.BaseView.extend({id:"transaction",template_name:"admin/transaction",events:{"click .submit-container button.back":"back","click .customer":"customer","click .counselor":"counselor"},render:function(){return app.BaseView.prototype.render.call(this),this},back:function(a){return app.router.navigate("transactions",!0),!1},customer:function(a){var b=$(a.currentTarget).attr("data-uuid");return app.router.navigate("customer/"+b,!0),!1},counselor:function(a){var b=$(a.currentTarget).attr("data-uuid");return app.router.navigate("counselor/"+b,!0),!1}}),app.CalendarView=app.BaseView.extend({template_name:"dashboard/calendar",event_template:'<div data-uuid="<%=uuid%>" class="event"><a href="http://addtocalendar.com/atc/google?utz=-300&uln=en-US&vjs=1.5&e[0][date_start]=<%=date%> <%= start_time %>&e[0][date_end]=2017-09-25%2017%3A00%3A00&e[0][timezone]=<%=app.user.timezone%>&e[0][title]=Video%20Session%20with%20Kali&e[0][description]=Video%20Session%20with%20Kali&e[0][location]=Video%20Session&e[0][organizer]=Kali%20Rogers&e[0][organizer_email]=" class="title"><%=title%></a></div>',events:{"click .diary":"open_diary"},initialize:function(a){app.BaseView.prototype.initialize.call(this,a)},render:function(){return app.BaseView.prototype.render.call(this),$(".nav li a").removeClass("active"),$(".nav li a.calendar").addClass("active"),this},build_calendar:function(){var a=this;this.$el.find("#main-calendar").fullCalendar({header:{left:"prev",center:"title",right:"next"},events:app.rest_root+"events/",eventRender:function(b,c,d){$(c).attr("data-uuid",b.uuid).html(_.template(a.event_template,b))}})}}),app.ConversationListView=app.BaseListView.extend({id:"conversations",messageListCollection:void 0,messageListView:void 0,template_name:"dashboard/conversations",events:{"click .conversation":"conversation","change #conversation-selector":"select_conversation"},render:function(a){if(app.BaseListView.prototype.render.call(this,a),$(".nav li a").removeClass("active"),$(".nav li a.messages").addClass("active"),!this.getConversationUuid()){var b=_.first(a.models);b&&this.setConversationUuid(b.get("uuid"))}return this.renderMessageList(this.getConversationUuid()),this.$el.find(".conversation:first").addClass("active"),this},conversation:function(a){return this.$el.find(".conversation").removeClass("active"),this.setConversationUuid($(a.currentTarget).attr("data-id")),this.renderMessageList(this.getConversationUuid()),$(a.currentTarget).addClass("active"),!1},select_conversation:function(a){return this.setConversationUuid($(a.currentTarget).val()),this.renderMessageList(this.getConversationUuid()),!1},setConversationUuid:function(a){this.options.conversation_uuid=a},getConversationUuid:function(){return this.options.conversation_uuid},renderMessageList:function(a){var b=this;this.messageListCollection||(this.messageListCollection=new app.MessageListCollection),this.messageListCollection.uuid=a,this.messageListCollection.fetch({success:function(a,c,d){b.messageListView&&b.messageListView.remove(),b.messageListView=new app.MessageListView({conversation_uuid:b.getConversationUuid()}),app.router.renderCollectionView(b.messageListView,a,"#message-list")}})}}),app.CreditsView=app.BaseView.extend({events:{"click .input-group-addon":"toggle_count","click button.submit":"submit"},template_name:"dashboard/credits",initialize:function(a){app.BaseFormView.prototype.initialize.call(this,a),this.bind("ok",this.confirm)},render:function(){return app.BaseView.prototype.render.call(this),this},_get_diary_amount:function(){return Math.max(parseInt(this.$el.find(".diary-count input").val()),0)},_get_counseling_amount:function(){return Math.max(parseInt(this.$el.find(".counseling-count input").val()),0)},_get_total:function(){var a=this._get_diary_amount()*app.data.price_diary,b=this._get_counseling_amount()*app.data.price_counseling;return Math.max(a+b,0)},toggle_count:function(a){this.$el.find(".no-selection-error:visible").hide();var b=$(a.currentTarget).siblings("input");$(a.currentTarget).hasClass("plus")?b.val(parseInt(b.val())+1):parseInt(b.val())>0&&b.val(parseInt(b.val())-1),this.$el.find(".header .total").text("Total: "+accounting.formatMoney(this._get_total()))},confirm:function(a){return this.modal=a,this._get_total()<=0?(this.$el.find(".no-selection-error").show(),!1):(this.$el.find("#add-credits-form").hide(),this.$el.find("#add-credits-confirm").show(),void a.$el.find(".modal-footer").hide())},submit:function(){var a=this,b=this.$el.find("button.submit");b.button("loading"),$.ajax(app.rest_root+"users/purchase",{type:"POST",data:{diary_cnt:this._get_diary_amount(),counseling_cnt:this._get_counseling_amount()},dataType:"json",success:function(b,c,d){a.options.dashboard&&a.options.dashboard.trigger("addCredits",b.data.credits),a.modal&&a.modal.close()},error:function(c,d,e){var f=a.$el.find(".alert-danger");f.html("<strong>Error: </strong> There was an error with your submission.  Please try again").show(),b.button("reset")}})}}),app.CustomerView=app.BaseFormView.extend({id:"customer",template_name:"dashboard/customer",noteListCollection:void 0,noteListView:void 0,diaryListCollection:void 0,diaryListView:void 0,events:{"click .dropper":"open_menu","click .dropper-menu li":"menu_choice"},render:function(){return app.BaseFormView.prototype.render.call(this),$(".nav li a").removeClass("active"),$(".nav li a.customers").addClass("active"),"diaries"===this.options.path?this.renderDiaryList():"notes"===this.options.path?this.renderNotesList():this.renderInfo(),this},open_menu:function(){return this.$el.find(".dropper-menu").show(),!1},menu_choice:function(a){this.$el.find(".dropper-menu li").removeClass("active"),$(a.currentTarget).hasClass("notes")?(this.renderNotesList(),app.router.navigate("customer/"+this.model.get("uuid")+"/notes")):$(a.currentTarget).hasClass("diary")?(this.renderDiaryList(),app.router.navigate("customer/"+this.model.get("uuid")+"/diaries")):$(a.currentTarget).hasClass("info")&&(this.renderInfo(),app.router.navigate("customer/"+this.model.get("uuid")+"/info")),this.$el.find(".dropper-menu").hide()},renderNotesList:function(){this.$el.find(".dropper .icon").hide(),this.$el.find(".dropper-menu li.notes").addClass("active"),this.$el.find(".dropper .icon-notes").css("display","block");var a=this;this.noteListCollection||(this.noteListCollection=new app.NoteListCollection),this.noteListCollection.uuid=this.model.get("uuid"),this.noteListCollection.fetch({success:function(b,c,d){a.noteListView&&a.noteListView.remove(),a.noteListView=new app.NoteListView({user_uuid:a.model.get("uuid")}),app.router.renderCollectionView(a.noteListView,b,"#item-list")}})},renderDiaryList:function(){this.$el.find(".dropper .icon").hide(),this.$el.find(".dropper-menu li.diary").addClass("active"),this.$el.find(".dropper .icon-diary").css("display","block");var a=this;this.diaryListCollection||(this.diaryListCollection=new app.DiaryListCollection),this.diaryListCollection.uuid=this.model.get("uuid"),this.diaryListCollection.fetch({success:function(b,c,d){a.diaryListView&&a.diaryListView.remove(),a.diaryListView=new app.DiaryListCounselorView({user_uuid:a.model.get("uuid")}),app.router.renderCollectionView(a.diaryListView,b,"#item-list")}})},renderInfo:function(){this.$el.find(".dropper .icon").hide(),this.$el.find(".dropper-menu li.info").addClass("active"),this.$el.find(".dropper .icon-info").css("display","block");var a=this;a.infoView&&a.infoView.remove(),a.infoView=new app.InfoView({model:a.model}),app.router.renderView(a.infoView,"#item-list",function(){})}}),app.CustomerListView=app.BaseListView.extend({id:"customers",template_name:"dashboard/customers",events:{"click .customer":"customer"},render:function(a){return app.BaseListView.prototype.render.call(this,a),$(".nav li a").removeClass("active"),$(".nav li a.customers").addClass("active"),this},customer:function(a){var b=$(a.currentTarget).attr("data-id");app.router.navigate("customer/"+b+"/info",!0)}}),app.DashboardCounselorView=app.BaseView.extend({el:"#backbone-container",template_name:"dashboard/dashboard",events:{"click #sidebar .nav .calendar":"calendar","click #sidebar .nav .messages":"conversations","click #sidebar .nav .customers":"customers","click button.start-session":"start_video_chat"},render:function(){return app.BaseFormView.prototype.render.call(this),this.upcoming_event(),this},calendar:function(a){return app.router.navigate("calendar",!0),!1},conversations:function(a){return app.router.navigate("conversations",!0),!1},customers:function(a){return app.router.navigate("customers",!0),!1},upcoming_event:function(a){var b=this;app.fetch_upcoming_event(b),setTimeout(function(){b.upcoming_event()},6e4)},start_video_chat:function(a){var b=(new Date).getTime();return window.open(app.app_root+"chats/event/"+$(a.currentTarget).attr("data-id")+"/"+b,"Blush Video Session","height=600,width=800,status=no,toolbar=yes,titlebar=no"),!1}}),app.DashboardCustomerView=app.BaseView.extend({el:"#backbone-container",template_name:"dashboard/dashboard",events:{"click .user-meta .messages a":"messages","click .user-meta .diaries a":"diaries","click #btn-add-diary":"diary","click #btn-add-video":"add_video","click #btn-add-credits":"add_credits","click .fc-event":"event","click button.start-session":"start_video_chat"},initialize:function(a){app.BaseFormView.prototype.initialize.call(this,a),this.bind("addCredits",this.add_credits_complete)},render:function(){return app.BaseFormView.prototype.render.call(this),this.calendar(),this.upcoming_event(),this.welcome(),this},messages:function(a){return app.router.navigate("messages",!0),!1},event:function(a){var b=$(a.currentTarget).attr("data-uuid");return app.router.navigate("event/"+b,!0),!1},diary:function(a){return parseInt(app.user.credits)<app.data.credits_diary?app.error_message(app.msg_error.credits_invalid_diary,this.alert_container):app.user.counselor.uuid?app.router.navigate("diary",!0):app.error_message(app.msg_error.no_counselor,this.alert_container),!1},add_video:function(a){return parseInt(app.user.credits)<app.data.credits_counseling?app.error_message(app.msg_error.credits_invalid_video,this.alert_container):app.user.counselor.uuid?app.router.navigate("add-video",!0):app.error_message(app.msg_error.no_counselor,this.alert_container),!1},diaries:function(a){return app.router.navigate("diaries",!0),!1},add_credits:function(a){var b=this;return app.template_cache.load(["dashboard/credits"],function(){b.modalView&&b.modalView.remove(),b.creditsView=new app.CreditsView({dashboard:b,model:b.model}),b.modalView=new Backbone.BootstrapModal({content:b.creditsView,modalClass:"add-credits",allowOk:b.model.get("stripe_customer_id"),okText:"SUBMIT",okCloses:!1}).open()}),!1},welcome:function(){var a=this;app.user.previous_login||$.get(app.rest_root+"users/welcome",{},function(b){b&&(a.modalView=new Backbone.BootstrapModal({content:b,title:"Welcome!",modalClass:"welcome",allowOk:!0,allowCancel:!1}).open())})},add_credits_complete:function(a){app.success_message(app.msg_success.credits_purchase,this.alert_container),this.$el.find("div.credits strong").text(a)},calendar:function(){$("#sidebar-calendar").fullCalendar({header:{left:"prev",center:"title",right:"next"},events:app.rest_root+"events/",eventRender:function(a,b,c){$(b).attr("data-uuid",a.uuid).html('<div class="fc-day-number">'+a.day+"</div>")}})},upcoming_event:function(){app.fetch_upcoming_event(this)},start_video_chat:function(a){var b=(new Date).getTime();return window.open(app.app_root+"chats/event/"+$(a.currentTarget).attr("data-id")+"/"+b,"Blush Video Session","height=600,width=800,status=no,toolbar=yes,titlebar=no"),!1}}),app.DiaryView=app.BaseFormView.extend({id:"diary",className:"diary",template_name:"dashboard/diary",MAX_WORD_COUNT:350,events:{"click .submit-container button.cancel":"cancel","click .submit-container button.submit":"submit","click .submit-container button.save":"save_draft"},render:function(){return console.log(this.model),app.BaseFormView.prototype.render.call(this),this},cancel:function(a){return app.router.navigate("diaries",!0),!1},save_draft:function(a){return this.model.set("draft",1),app.BaseFormView.prototype.save.call(this,a,void 0,function(a){}),!1},submit:function(a){var b=this;return this.model.set("draft",0),app.BaseFormView.prototype.save.call(this,a,void 0,function(a){a.data.uuid&&(app.user.credits=app.user.credits-app.data.credits_diary,$("#sidebar .credits strong").text(app.user.credits),b.$el.find("button.save, button.submit").hide(),b.$el.find("button.cancel").text("Close"))}),!1},count_words:function(a){var b=$(a.currentTarget).val().trim().split(" "),c=b.length,d=this.$el.find(".word-count");c>this.MAX_WORD_COUNT?(this.$el.find("button.submit").attr("disabled","disabled"),d.addClass("invalid")):(this.$el.find("button.submit").removeAttr("disabled"),d.removeClass("invalid")),d.text(this.MAX_WORD_COUNT-c)}}),app.DiaryListCounselorView=app.BaseListView.extend({id:"diaries",template_name:"dashboard/diaries-counselor",events:{"click .diary-counselor .title":"toggle_diary","click .comments button.submit":"save_comments"},toggle_diary:function(a){var b=$(a.currentTarget).parent().find(".body-comments");if(b.toggle(),b.is(":visible")){var c=$(a.currentTarget).closest(".diary-counselor"),d=c.attr("data-read");if(parseInt(d)<1){var e=new app.Diary({uuid:c.attr("data-uuid"),read:1,draft:0});e.save(),c.attr("data-read",1)}}},save_comments:function(a){var b=$(a.currentTarget).attr("data-uuid");return this.save(a,new app.Diary({uuid:b,draft:0}),void 0,$(a.currentTarget).closest(".body-comments")),!1}}),app.DiaryListCustomerView=app.BaseListView.extend({id:"diaries",template_name:"dashboard/diaries",events:{"click .diary":"open_diary"},open_diary:function(a){var b=$(a.currentTarget).attr("data-id");app.router.navigate("diary/"+b,!0)}}),app.EventView=app.BaseView.extend({id:"event",className:"event col-lg-12",template_name:"dashboard/event",events:{"click .submit-container button.cancel":"cancel"},cancel:function(a){return app.router.navigate("events",!0),!1}}),app.EventListView=app.BaseListView.extend({id:"events",template_name:"dashboard/events",events:{"click button.cancel":"cancel_event"},cancel_event:function(a){var b=this;$(a.currentTarget).closest(".event").find(".alert-danger").empty().hide();var c=$(a.currentTarget);c.button("loading");var d=$(a.currentTarget).attr("data-uuid");return $.ajax(app.rest_root+"events/cancel",{type:"POST",data:{uuid:d},dataType:"json",success:function(d,e,f){c.button("reset"),$(a.currentTarget).closest(".event").remove(),app.success_message(d.message,b.$el.find(".alert-container")),app.user.credits=d.data.user.credits,app.user.pending_credits=d.data.user.pending_credits,$("#sidebar .credits strong").text(app.user.credits-app.user.pending_credits)},error:function(b,d,e){c.button("reset");var f=$.parseJSON(b.responseText).message,g=$(a.currentTarget).closest(".event").find(".alert-danger");g.html("<strong>Error: </strong> "+f).show(),submit_btn.button("reset")}}),!1}}),app.InfoView=app.BaseView.extend({id:"info",template_name:"dashboard/info"}),app.MessageView=app.BaseFormView.extend({id:"message",template_name:"dashboard/message",cancel_url:app.get_router()?app.get_router().root_url+"messages/":app.root_url+"messages/",events:{"click .submit-container button.cancel":"cancel","click .submit-container button.submit":"save"},render:function(){return app.BaseFormView.prototype.render.call(this),this},cancel:function(a){return app.router.navigate(this.cancel_url,!0),!1}}),app.MessageListView=app.BaseListView.extend({id:"messages",template_name:"dashboard/messages",events:{"click .new-message":"message","click .submit-container .submit":"reply"},message:function(a){return app.user.user_type_id!=app.user_type_customer||app.user.counselor.uuid?app.router.navigate("message",!0):app.error_message(app.msg_error.no_counselor,this.alert_container),!1},reply:function(a){var b=this,c=new app.Message,d=this.$el.find("form").serializeObject();d.conversation_uuid=this.options.conversation_uuid;var e=this.$el.find(".submit-container button.submit");return e.button("loading"),this.$el.find(".submit-container .alert").hide(),c.save(d,{success:function(a,c,d){if(c&&c.message){var f=b.$el.find(".submit-container .alert-success");f.html("<strong>Success: </strong> "+c.message).show(),f.delay(3e3).fadeOut(),b.collection.fetch({success:function(a){b.render(a);var c=b.$el.find(".reply").offset().top;$("html,body").animate({scrollTop:c},300)}})}e.button("reset")},error:function(a,c,d){var f=b.$el.find(".submit-container .alert-danger");f.html("<strong>Error: </strong> There was an error with your submission.  Please try again").show(),e.button("reset")}}),!1}}),app.NoteListView=app.BaseListView.extend({id:"notes",template_name:"dashboard/notes",user_uuid:void 0,events:{"click .submit-container .btn-primary":"add_note"},render:function(a){return app.BaseListView.prototype.render.call(this,a),this},add_note:function(a){a.stopPropagation();var b=new app.Note;return b.urlRoot=b.urlRoot+"/"+this.options.user_uuid,this.save(a,b),!1}}),app.VideoAddView=app.BaseFormView.extend({id:"video_add",template_name:"dashboard/videoadd",template_availability_name:"dashboard/includes/videoadd-availability",events:{"change #session_date":"update_timeslots","click #video-add-submit":"save"},initialize:function(a){app.BaseFormView.prototype.initialize.call(this,a),this.options.availability=this.options.availability.toJSON()},render:function(){return app.BaseFormView.prototype.render.call(this),this.$el.find(".datepicker").datepicker({autoclose:!0}),this},validate:function(){var a=app.calculate_24hours(),b=this.$el.find("#session_date").val(),c=this.$el.find("#session_time").val(),d=app.date_from_input(b,c);return a.getTime()>d.getTime()&&app.data.prevent_schedule_24hour?(app.error_message("Video sessions cannot be schedule less than 24 hours in advance.",this.$el.find(".alert-holder")),!1):!0},update_timeslots:function(a){var b=this,c=$(a.currentTarget).val();$.ajax({url:app.rest_root+"events/timeslots",method:"POST",data:{session_date:c},success:function(a){var d=_.template(app.template_cache.get(b.template_availability_name),{model:a,session_date:c});b.$el.find(".additional-availability").html(d)}})},save:function(a){if(this.$el.find("form").valid()&&this.validate()){var b=$(a.currentTarget);b.button("loading");var c=this.$el.find("form").serializeObject(),d=this;$.ajax({url:app.rest_root+"events/video_add",method:"POST",data:c,success:function(a){b.button("reset"),app.router.navigate("events",!0),app.success_message("Your video session has been scheduled successfully",$("#dashboard-alerts")),app.user.credits=a.data.user.credits,app.user.pending_credits=a.data.user.pending_credits,$("#sidebar .credits strong").text(app.user.credits-app.user.pending_credits)},error:function(a,c,e){b.button("reset");var f=$.parseJSON(a.responseText);f.message&&app.error_message(f.message,d.$el.find(".alert-holder"))}})}return!1}}),app.AccountTypeView=app.BaseFormView.extend({template_name:"my_account/account_type",events:{"click .submit-container button.submit":"save","click .plan-item .choose":"choose_plan","click .plan-cancel":"cancel_plan"},initialize:function(a){app.BaseFormView.prototype.initialize.call(this,a),this.options.pricing=this.options.pricing.toJSON()},render:function(){return app.BaseFormView.prototype.render.call(this),$(".nav li a").removeClass("active"),$(".nav li a.account_type").addClass("active"),this},choose_plan:function(a){return this.$el.find(".item-container.current").removeClass("current"),$(a.currentTarget).closest(".item-container").addClass("current"),this.model.set("plan_id",$(a.currentTarget).attr("data-id")),!1},cancel_plan:function(a){var b=this;return app.get_router().confirm("Cancel Subscription?","Are you sure you want to cancel your subscription?",function(){b.model.set("plan_id",-1),b.save(null,null,function(){app.success_message("Your subscription has been cancelled successfully!  Thank you for your business!"),b.$el.find(".item-container.current").removeClass("current"),b.$el.find(".plan-cancel").hide()})}),!1}}),app.AvailabilityView=app.BaseFormView.extend({template_name:"my_account/availability",events:{"click .submit-container button.add":"add","click .remove":"remove"},add_template:'<tr data-id="<%=id%>"><td><%=day_of_week%></td><td><%=pretty_start_time%></td><td><%=pretty_end_time%></td><td><button class="btn btn-xs pull-right btn-danger remove">Delete</button></td></tr>',initialize:function(a){app.BaseFormView.prototype.initialize.call(this,a),this.options.availability=this.options.availability.toJSON()},render:function(){var a=this;return app.BaseFormView.prototype.render.call(this),$(".nav li a").removeClass("active"),$(".nav li a.availability").addClass("active"),setTimeout(function(){a.calendarView=new app.AvailabilityCalendarView({model:new app.AvailabilityCalendar}),app.get_router().renderView(a.calendarView,"#availability-calendar-container",function(){a.calendarView.build_calendar()})},500),setTimeout(function(){a.$el.find("#calendar").removeClass("active")},1e3),this},remove:function(a){var b=this;if(a){var c=$(a.currentTarget).closest("tr"),d=c.attr("data-id"),e={action:"remove",id:d};$.ajax(app.rest_root+"users/availability",{dataType:"json",data:e,type:"POST",success:function(a){app.success_message("Your availability day has been successfully removed.",b.$el.find(".alert-container")),c.remove()},error:function(){b.$el.find(".alert-danger").show().html("<p>There was an error while saving your entry, please try again.</p>")}})}},add:function(a){var b=this;if(this.$el.find(".alert-danger").hide().empty(),this.$el.find("form").valid()){var c={action:"add",day:this.$el.find("#day").val(),start_time:this.$el.find("#start_time").val(),end_time:this.$el.find("#end_time").val()};c.start_time>=c.end_time?this.$el.find(".alert-danger").show().html("<p>Start Time should be before End Time.</p>"):$.ajax(app.rest_root+"users/availability",{dataType:"json",data:c,type:"POST",success:function(a){app.success_message("Your availability day has been successfully added.",b.$el.find(".alert-container")),b.$el.find("table").append(_.template(b.add_template,a))},error:function(){b.$el.find(".alert-danger").show().html("<p>There was an error while saving your entry, please try again.</p>")}})}return!1}}),app.AvailabilityCalendarView=app.BaseView.extend({template_name:"my_account/includes/availability-calendar-calendar",event_template:'<div data-id="<%=id%>" class="availability <%=cls%>"><div class="title"><%=title%></div><button class="calendar-remove"><i class="fa fa-times text-danger"></i></button></div>',events:{"click .fc-day .fc-day-number":"show_modal","click .btn-save-availability-calendar":"save",
"click .calendar-remove":"destroy","change .is_all_day":"change_is_all_day"},initialize:function(a){app.BaseView.prototype.initialize.call(this,a),this.on("save_complete",this.after_save)},render:function(){return app.BaseView.prototype.render.call(this),this},destroy:function(a){var b=$(a.currentTarget).closest(".availability").data("id");this.model=new app.AvailabilityCalendar({id:b}),app.BaseView.prototype.destroy.call(this,a)},change_is_all_day:function(a){var b=$(a.currentTarget).prop("checked");b?(this.$el.find(".form-group-date").hide(),this.$el.find(".is_all_day_val").val(1),this.$el.find(".form-group-date input").data("rule-required",!1)):(this.$el.find(".form-group-date").show(),this.$el.find(".is_all_day_val").val(""),this.$el.find(".form-group-date input").data("rule-required",!0))},after_save:function(a){$("#availability-calendar-modal").modal("hide"),this.$el.find("#availability-calendar").fullCalendar("refetchEvents")},show_modal:function(a){var b=$(a.currentTarget).closest(".fc-day").data("date");this.model=new app.AvailabilityCalendar,this.$el.find("#availability-calendar-modal input,#availability-calendar-modal select").val(""),this.$el.find("#availability-calendar-modal input").prop("checked",""),this.$el.find(".form-group-date").show(),this.$el.find(".is_all_day_val").val(""),this.$el.find('#availability-calendar-modal input[name="date"]').val(b),this.$el.find("#availability-calendar-modal").modal("show")},build_calendar:function(){var a=this;this.$el.find("#availability-calendar").fullCalendar({header:{left:"prev",center:"title",right:"next"},contentHeight:1e3,events:app.rest_root+"users/availability_calendar/",eventRender:function(b,c,d){$(c).attr("data-uuid",b.uuid).html(_.template(a.event_template,b))},eventAfterAllRender:function(a){$(".fc-day .fc-day-number").each(function(){$(this).find(".fa").length<1&&$(this).append('<i class="fa fa-plus-circle"></i>')})}})}}),app.NotificationsView=app.BaseFormView.extend({template_name:"my_account/notifications",events:{"click .submit-container button.submit":"save"},render:function(){return app.BaseFormView.prototype.render.call(this),$(".nav li a").removeClass("active"),$(".nav li a.notifications").addClass("active"),this}}),app.MyAccountView=app.BaseView.extend({el:"#backbone-container",template_name:"my_account/my_account",events:{"click .side-nav li a":"route"},render:function(){return app.BaseView.prototype.render.call(this),this},route:function(a){return app.router.navigate($(a.currentTarget).attr("class"),!0),!1}}),app.PasswordView=app.BaseFormView.extend({template_name:"my_account/password",events:{"click .submit-container button.submit":"save"},render:function(){return app.BaseFormView.prototype.render.call(this),$(".nav li a").removeClass("active"),$(".nav li a.password").addClass("active"),this}}),app.PaymentView=app.BaseFormView.extend({template_name:"my_account/payment",events:{"click .submit-container button.submit":"save","click .card-fields-toggle":"toggle_card_fields"},render:function(){return app.BaseFormView.prototype.render.call(this),$(".nav li a").removeClass("active"),$(".nav li a.payment").addClass("active"),this},save:function(a){if(this.$el.find("form").valid()){var b=this.$el.find(".submit-container button.submit");if(b.button("loading"),this.$el.find(".submit-container .alert").hide(),$(".card-number").length>0){var c=$(".card-number").val();c?this.save_card(b):this.save_success(null,"credit")}else{var c=$(".account-number").val();c?this.save_checking(b):this.save_success(null,"checking")}}return!1},save_card:function(a){var b=this;Stripe.createToken({number:$(".card-number").val(),cvc:$(".card-cvc").val(),exp_month:$(".card-expiry-month").val(),exp_year:$(".card-expiry-year").val(),name:$(".cardholder-name").val()},function(c,d){if(d.error){var e=b.$el.find(".submit-container .alert-danger");e.show().text(d.error.message),a.button("reset")}else b.save_success(d,"credit")})},save_checking:function(a){var b=this;Stripe.bankAccount.createToken({country:"US",routingNumber:$(".routing-number").val(),accountNumber:$(".account-number").val()},function(c,d){if(d.error){var e=b.$el.find(".submit-container .alert-danger");e.show().text(d.error.message),a.button("reset")}else b.save_success(d,"checking")})},save_success:function(a,b){var c=this.$el.find("#payment-form");if(a){var d=a.id;c.append("<input type='hidden' name='stripe_token' value='"+d+"' />")}this.model.set("account_type",b),app.BaseFormView.prototype.save.call(this),this.model.set("stripe_token","")},toggle_card_fields:function(a){return this.$el.find(".card-fields").toggle(),!1}}),app.ProfileView=app.BaseFormView.extend({template_name:"my_account/profile",registration:void 0,events:{"click .registration .submit-container button.save":"save_registration","click .submit-container button.submit":"save","click .picture-upload-link":"choose_picture","change #picture-upload-input":"submit_picture","change .yes-no-more input":"toggle_more_text"},render:function(){app.BaseFormView.prototype.render.call(this);var a=this;return $(".nav li a").removeClass("active"),$(".nav li a.profile").addClass("active"),this.$el.find(".datepicker").datepicker({autoclose:!0}),this.$el.find(".choices input").each(function(b){var c=$(this).attr("name"),d=$(this).attr("value");a.registration.get(c)===d&&$(this).parent().button("toggle")}),this},choose_picture:function(a){return this.$el.find("#picture-upload-input").click(),!1},toggle_more_text:function(a){var b=$(a.currentTarget).val(),c=this.$el.find("div."+$(a.currentTarget).attr("name"));"Yes"===b?c.show():c.hide()},save_registration:function(a){var b=$(a.currentTarget).closest("form");if(b.valid()){var c=b.serializeObject(),d=this,e=$(a.currentTarget);e.button("loading"),b.find(".submit-container .alert").hide(),this.registration.save(c,{success:function(a,c,f){if(c&&c.message){var g=b.find(".submit-container .alert-success");g.html("<strong>Success: </strong> "+c.message).show(),g.delay(3e3).fadeOut()}e.button("reset"),d.trigger("save_complete")},error:function(a,c,d){var f=b.find(".submit-container .alert-danger"),g="";g=c.responseJSON&&c.responseJSON.message?c.responseJSON.message:"<strong>Error: </strong> There was an error with your submission.  Please try again",f.html(g).show(),e.button("reset")}})}return!1},submit_picture:function(a){var b=this,c=$(a.currentTarget),d=this.$el.find(".picture-upload-link");d.button("loading"),$.ajax(app.rest_root+"users/picture",{iframe:!0,files:c,dataType:"json"}).done(function(a){if(d.button("reset"),"error"==a.status){var c=b.$el.find(".submit-container .alert-danger");c.show().text("The picture you are attempting to upload is too large.  Please choose a smaller image.")}else b.$el.find(".profile-picture").attr("src",a.data.picture_url)})}}),app.BaseStepView=app.BaseFormView.extend({events:{"click .submit-container .previous":"previous","click .submit-container .next":"next","change .yes-no-more input":"toggle_more_text"},render:function(){app.BaseFormView.prototype.render.call(this);var a=this;return this.$el.find(".choices input").each(function(b){var c=$(this).attr("name"),d=$(this).attr("value");a.model.get(c)===d&&$(this).parent().button("toggle")}),this},previous:function(a){var b=this.$el.find("form").serializeObject(),c=this;return this.model.save(b,{success:function(a,b,d){b&&b.message&&(b.data&&b.data.uuid&&c.model.set("uuid",b.data.uuid),c.model.unset("password"),c.model.unset("confirm_password")),app.router.navigate(c.previous_url,!0)}}),!1},next:function(a){if(this.$el.find("form").valid()){var b=this.$el.find("form").serializeObject(),c=this,d=this.$el.find(".submit-container button.submit");d.button("loading"),this.model.save(b,{success:function(a,b,d){b&&b.message&&(b.data&&b.data.uuid&&c.model.set("uuid",b.data.uuid),c.model.unset("password"),c.model.unset("confirm_password")),app.router.navigate(c.next_url,!0)},error:function(a,b,e){var f=c.$el.find(".submit-container .alert-danger");f.html("<strong>Error: </strong> There was an error with your submission.  Please try again").show(),d.button("reset")}})}return!1},toggle_more_text:function(a){var b=$(a.currentTarget).val(),c=this.$el.find("div."+$(a.currentTarget).attr("name"));"Yes"===b?c.show():c.hide()}}),app.PlanView=app.BaseStepView.extend({id:"plans",TYPE_ALACARTE:"alacarte",TYPE_SUBSCRIPTION:"subscription",chosen_plan_id:void 0,coupon_code:void 0,chosen_price:0,chosen_plan_name:void 0,events:{"click .submit-container .previous":"previous","click .submit-container .submit":"submit","click a.choose":"choose","click a.cancel":"cancel","click button.cancel":"cancel","click .card-submit-container button.submit":"submit_payment","click .coupon-code-button":"check_coupon_code","click .coupon-code-reset-button":"coupon_code_remove"},template_name:"registration/plan",previous_url:"",initialize:function(a){app.BaseStepView.prototype.initialize.call(this,a),this.options.pricing=this.options.pricing.toJSON()},render:function(){return app.BaseStepView.prototype.render.call(this),this.$el.find(".datepicker").datepicker({autoclose:!0}),this},cancel:function(a){return $(".item-container").removeClass("inactive").removeClass("active"),$(".card-fields").hide(),$(".alacartes").show(),$(".plans").show(),!1},choose:function(a){this.chosen_plan_id=$(a.currentTarget).attr("data-id"),this.chosen_price=$(a.currentTarget).closest(".plan-item").find(".price span").data("original"),this.chosen_plan_name=$(a.currentTarget).closest(".plan-item").find("h4").text(),$(a.currentTarget).closest(".item-container").addClass("active"),$(".item-container:not(.active)").addClass("inactive"),$(".card-fields").show();var b=$(a.currentTarget).attr("data-type");return b===this.TYPE_ALACARTE?this.choose_alacarte(a):this.choose_subscription(a),!1},choose_subscription:function(a){$(".alacartes").hide(),$(".coupon-code-container").show()},choose_alacarte:function(a){$(".plans").hide(),$(".coupon-code-container").hide()},check_coupon_code:function(a){var b=this,c=$(a.currentTarget).closest(".input-group").find("input"),d=c.val(),e=$(".plan-"+this.chosen_plan_id+" .price span");$(".coupon-code-alerts .alert").hide(),b.coupon_code=void 0,d?$.ajax(app.rest_root+"plans/coupon_code",{dataType:"json",data:{code:d,plan_id:this.chosen_plan_id},success:function(c){e.text(c.data.price),$(".coupon-code-alerts .alert-success").show(),$(a.currentTarget).hide(),b.$el.find(".coupon-code-reset-button").show(),b.coupon_code=d},error:function(){$(".coupon-code-alerts .alert-danger").show(),c.val(""),b.coupon_code=""}}):e.val(e.attr("data-original"))},coupon_code_remove:function(a){this.$el.find(".coupon-code-button").show(),$(".coupon-code-alerts .alert").hide(),$(a.currentTarget).hide(),this.coupon_code="";var b=$(".plan-"+this.chosen_plan_id+" .price span");return b.text(b.data("original")),$(a.currentTarget).closest(".input-group").find("input").val(""),!1},record_conversion:function(a,b){window._fbq&&window._fbq.push&&window._fbq.push(["track","6030582505998",{value:this.chosen_price,currency:"USD"}]),console.log(ga),ga("ecommerce:addTransaction",{id:b.user.uuid,affiliation:"Blush",revenue:this.chosen_price,shipping:0,tax:0}),ga("ecommerce:addItem",{id:b.user.uuid,name:this.chosen_plan_name,sku:"",category:"",price:this.chosen_price,quantity:1}),ga("ecommerce:send")},submit_payment:function(a){var b=this,c=$(a.currentTarget).closest("form"),d=$(a.currentTarget);return c.valid()&&(d.button("loading"),Stripe.createToken({number:$(c).find(".card-number").val(),cvc:$(c).find(".card-cvc").val(),exp_month:$(c).find(".card-expiry-month").val(),exp_year:$(c).find(".card-expiry-year").val(),name:$(c).find(".cardholder-name").val()},function(e,f){if(f.error){var g=c.find(".alert-danger");g.show().text(f.error.message),d.button("reset")}else{var h={chosen_plan_id:b.chosen_plan_id,code:b.coupon_code,token:f.id,completed:1};b.model.save(h,{success:function(c,e){d.button("reset");var f=e.data;f&&f.inactive>0&&(window.location=app.app_root+"login/"),b.record_conversion(a,e.data),window.location=app.app_root+"dashboard/"},error:function(a,c){var e=b.$el.find(".submit-container .alert-danger"),f="";f=c.responseJSON&&c.responseJSON.message?c.responseJSON.message:"<strong>Error: </strong> There was an error with your submission.  Please try again",e.html(f).show(),d.button("reset")}})}})),!1}}),app.Step1View=app.BaseStepView.extend({VAL_MY_COUNSELOR:"My Coach",VAL_OTHER:"Other",events:{"click .submit-container .previous":"previous","click .submit-container .next":"next","change .yes-no-more input":"toggle_more_text","change #referral":"referral_source","change #birthday":"validate_birthday","click .non-us":"toggle_state"},template_name:"registration/step1",next_url:"plan",render:function(){return this.model.get("timezone")||this.model.set("timezone",app.get_timezone()),app.BaseStepView.prototype.render.call(this),this.$el.find(".datepicker").datepicker({autoclose:!0}),this},referral_source:function(a){this.$el.find("div.counselor").hide().find("input").removeAttr("data-rule-required"),this.$el.find("div.other").hide().find("input").removeAttr("data-rule-required"),$(a.currentTarget).val()==this.VAL_MY_COUNSELOR?this.$el.find("div.counselor").show().find("input").attr("data-rule-required","true"):$(a.currentTarget).val()==this.VAL_OTHER&&this.$el.find("div.other").show().find("input").attr("data-rule-required","true")},toggle_state:function(a){var b=$(a.currentTarget).prop("checked");console.log(b),b?this.$el.find("#state").hide():this.$el.find("#state").show()},validate_birthday:function(a){var b=$(".alert-container");app.clear_message(b);var c=app.calculate_age($(a.currentTarget).val());return 13>c?(this.$el.find(".btn-primary").attr("disabled","disabled"),void app.error_message("You must be over the age of 13 in order to use Blush.",b,3e4)):18>c?(this.$el.find(".btn-primary").removeAttr("disabled"),this.$el.find(".parent-email-container").show(),void $("#parent_consent").attr("data-rule-required",!0)):(this.$el.find(".btn-primary").removeAttr("disabled"),this.$el.find(".parent-email-container").hide(),this.$el.find(".submit").removeAttr("disabled"),$("#parent_email").removeAttr("data-rule-required"),!1)}}),app.Step2View=app.BaseStepView.extend({template_name:"registration/step2",previous_url:"step1",next_url:"step3"}),app.Step3View=app.BaseStepView.extend({template_name:"registration/step3",previous_url:"step2",next_url:"step4"}),app.Step4View=app.BaseStepView.extend({template_name:"registration/step4",previous_url:"step3",next_url:"step5"}),app.Step5View=app.BaseStepView.extend({template_name:"registration/step5",previous_url:"step4",next_url:"plan",record_conversion:function(a){$.getScript("http://www.googleadservices.com/pagead/conversion.js");var b={};b.pixel_id="6014439113798",b.value="0.00",b.currency="USD",function(){var a=document.createElement("script");a.async=!0,a.src="//connect.facebook.net/en_US/fp.js";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)}()}});